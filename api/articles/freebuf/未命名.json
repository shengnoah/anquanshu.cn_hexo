{"title":"AI 安全实践 | 应用大语言模型阻断Emotet病毒的传播路径 - FreeBuf网络安全行业门户","uid":"0a4b48e476faf89256978f6ec14af548","slug":"freebuf/未命名","date":"2023-09-26T03:59:00.310Z","updated":"2023-09-26T03:59:45.696Z","comments":true,"path":"api/articles/freebuf/未命名.json","keywords":null,"cover":[],"content":"<h1 id=\"AI-安全实践-应用大语言模型阻断Emotet病毒的传播路径-FreeBuf网络安全行业门户\"><a href=\"#AI-安全实践-应用大语言模型阻断Emotet病毒的传播路径-FreeBuf网络安全行业门户\" class=\"headerlink\" title=\"AI 安全实践 | 应用大语言模型阻断Emotet病毒的传播路径 - FreeBuf网络安全行业门户\"></a>AI 安全实践 | 应用大语言模型阻断Emotet病毒的传播路径 - FreeBuf网络安全行业门户</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><h2 id=\"Excerpt\"><a href=\"#Excerpt\" class=\"headerlink\" title=\"Excerpt\"></a>Excerpt</h2><p>该方法将解决长期困扰邮件安全网关的难题，彻底破解通过加密压缩包传播病毒的路径。</p></blockquote>\n<hr>\n<p>Emotet是一种恶意软件或病毒，最初于2014年首次被发现。它被认为是最具破坏性和持久性的恶意软件之一，经常用于进行大规模的网络攻击和数据窃取行为。Emotet病毒主要通过电子邮件传播，并采取了一些方法来欺骗用户和绕过安全防护机制。</p>\n<p>在Emotet邮件的传播过程中，病毒会使用加密的压缩包作为附件。这些文档通常是常见的压缩格式，如ZIP或RAR格式。当用户尝试解压它们时，它们会提示用户输入一个密码来解压，同时在邮件正文中提供了相应的密码。这种做法是为了绕过安全网关（邮件网关，或是UTM）对邮件附件的扫描和检测。</p>\n<p><img src=\"https://image.3001.net/images/20230830/1693384806_64ef0066f3f8b64253bc7.png!small\"></p>\n<h2 id=\"LLM带来了新的解决方案\"><a href=\"#LLM带来了新的解决方案\" class=\"headerlink\" title=\"LLM带来了新的解决方案\"></a>LLM带来了新的解决方案</h2><p>对于加密的压缩包，安全网关通常有下面几种应对方法：</p>\n<ul>\n<li>  在邮件正文添加警告信息。提示用户注意鉴别压缩包中的文件。</li>\n<li>  使用预置的密码库尝试对压缩包进行穷举解压。</li>\n<li>  使用预定义的正则表达式，尝试从邮件正文中抽取解压密码。</li>\n</ul>\n<p>显然，上述的方法都无法从根本上解决这个问题。例如，预定义的正则表达式只能覆盖有限的表达方式。不过，随着LLM的到来，我们找到了新方法。</p>\n<p>从邮件正文中抽取解压密码可以被看作是一种命名实体识别（Named Entity Recognition, NER）任务，其目标是识别出文本中表示密码的实体。</p>\n<p>NER任务通常涉及将文本中的命名实体标记为预定义的类别，如人名、地名、组织机构等。在我们的应用场景中，我们需要识别出表示密码的实体，并将其标记为密码类别。</p>\n<p>应用LLM，传统NLP（自然语言处理）领域的NER任务的执行效果有了很大提升。所以，我们可以借助LLM执行NER任务，帮助我们解决抽取密码的问题。</p>\n<h2 id=\"训练数据的准备和标注\"><a href=\"#训练数据的准备和标注\" class=\"headerlink\" title=\"训练数据的准备和标注\"></a>训练数据的准备和标注</h2><p>选择合适的NLP开发库对于解决我们的问题很重要。在这里，我们选择了 Spacy 开发库。spaCy是一个流行的Python自然语言处理（NLP）库，被广泛用于文本处理和信息提取任务。它提供了一系列高效的工具和算法，可以帮助开发者处理和分析文本数据。</p>\n<p>另外，我们也需要选择一个基座模型。这里我们选择的是Spacy 提供的en_core_web_trf：</p>\n<p><img src=\"https://image.3001.net/images/20230830/1693384867_64ef00a3b37e4c77226ef.jpg!small\"></p>\n<p>source: <a href=\"https://spacy.io/models/en#en_core_web_trf\">https://spacy.io/models/en#en_core_web_trf</a></p>\n<p>按照 Spacy 的要求，我们需要准备训练数据，并进行标注。部分原始数据如下图：</p>\n<p><img src=\"https://image.3001.net/images/20230830/1693384903_64ef00c7d316055a0d2c4.jpg!small\"></p>\n<p>使用 Spacy 标注工具标注后的数据如下图：</p>\n<p><img src=\"https://image.3001.net/images/20230830/1693384924_64ef00dcf2b22d8cce368.jpg!small\"></p>\n<p>训练数据并不需要很多，因为我们是基于一个训练好的基座模型进行微调，所以，并不需要大量的数据从头训起，200条即可。这也是微调技术的重要的优点。</p>\n<h2 id=\"训练的过程\"><a href=\"#训练的过程\" class=\"headerlink\" title=\"训练的过程\"></a>训练的过程</h2><p>训练数据准备完成后，根据下图所示，在Spacy网站上，在线生成训练所需的配置文件 base_config.cfg，并下载下来：</p>\n<p><img src=\"https://image.3001.net/images/20230830/1693384954_64ef00fad3f715e1f9921.jpg!small\"></p>\n<p>Source: <a href=\"https://spacy.io/usage/training#basics\">https://spacy.io/usage/training#basics</a></p>\n<p>创建train.spacy， dev.spacy 和 output 目录，将 Spacy 标注工具生成的二进制训练数据放到 train.spacy 目录中，数据文件的扩展名是 .spcay ，训练程序会自动找这个扩展名的文件。</p>\n<p>目录结构最终如下图所示：</p>\n<p><img src=\"https://image.3001.net/images/20230830/1693385179_64ef01db44efd889e77f2.jpg!small\"></p>\n<p>目录train.spacy中放置的 train.spacy 文件就是训练数据。</p>\n<p>目录dev.spacy可放置用于验证的数据，也可以不放置任何验证数据。</p>\n<p>执行下面的命令生成config.cfg</p>\n<p>python -m spacy init fill-config base_config.cfg config.cfg 生成 config.cfg</p>\n<p>执行下面的命令开始训练</p>\n<p>python -m spacy train config.cfg –output ./output –paths.train ./train.spacy –paths.dev ./dev.spacy –gpu-id 0</p>\n<p>在 1660 super 的显卡上，训练花费约数十分钟，小于一个小时。 训练生成的模型存放在 output 目录下，大小约500MB。</p>\n<h2 id=\"识别效果\"><a href=\"#识别效果\" class=\"headerlink\" title=\"识别效果\"></a>识别效果</h2><p>下面的代码展示了如何加载训练好的数据，对输入的文本执行密码抽取任务：</p>\n<p><img src=\"https://image.3001.net/images/20230830/1693385235_64ef02130581f07ecde1c.jpg!small\"></p>\n<p>程序首先加载了模型，然后打印提示符，等待用户输入。我们从网络上收集了一些病毒邮件样本，测试模型的识别效果，并打印出识别所消耗的时间：</p>\n<p><img src=\"https://image.3001.net/images/20230830/1693386071_64ef0557bedfa445b144f.jpg!small\"></p>\n<p>除第一次识别会花费较多时间外（推测是加载过程的影响），识别仅需要花费80ms左右。</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>基于LLM（Large Language Model），利用NLP领域的NER技术，从邮件正文中抽取解压密码是一种完美的解决方案。LLM具有强大的语言理解和上下文理解能力。它可以理解复杂的句子结构和语义关系，有助于识别密码实体以及与其相关的上下文信息。借助微调技术，只需要少量训练数据，就可以在短时间得到满足需要的模型。即使未来出现了某种可以绕过LLM的表达方式，我们也可以快速训练出新的模型，并部署。</p>\n<p>基于本文的方案，不仅是 Emotet 病毒，所有利用加密压缩包的邮件传播方法都被有效的破解了。</p>\n","feature":true,"text":"AI 安全实践 | 应用大语言模型阻断Emotet病毒的传播路径 - FreeBuf网络安全行业门户 Excerpt该方法将解决长期困扰邮件安全网关的难题，彻底破解通过加密压缩包传播病毒的路径。 Emotet是一种恶意软件或病毒，最初于2014年首次被发现。它被认为是最具破坏性和...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"文章","slug":"文章","count":26,"path":"api/categories/文章.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#AI-%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5-%E5%BA%94%E7%94%A8%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E9%98%BB%E6%96%ADEmotet%E7%97%85%E6%AF%92%E7%9A%84%E4%BC%A0%E6%92%AD%E8%B7%AF%E5%BE%84-FreeBuf%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%A1%8C%E4%B8%9A%E9%97%A8%E6%88%B7\"><span class=\"toc-text\">AI 安全实践 | 应用大语言模型阻断Emotet病毒的传播路径 - FreeBuf网络安全行业门户</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Excerpt\"><span class=\"toc-text\">Excerpt</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#LLM%E5%B8%A6%E6%9D%A5%E4%BA%86%E6%96%B0%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">LLM带来了新的解决方案</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AE%AD%E7%BB%83%E6%95%B0%E6%8D%AE%E7%9A%84%E5%87%86%E5%A4%87%E5%92%8C%E6%A0%87%E6%B3%A8\"><span class=\"toc-text\">训练数据的准备和标注</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AE%AD%E7%BB%83%E7%9A%84%E8%BF%87%E7%A8%8B\"><span class=\"toc-text\">训练的过程</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AF%86%E5%88%AB%E6%95%88%E6%9E%9C\"><span class=\"toc-text\">识别效果</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BB%93%E8%AE%BA\"><span class=\"toc-text\">结论</span></a></li></ol></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"","uid":"f73a8e23e6f6f669cf99c7dba8fa0722","slug":"zhihu/未命名","date":"2023-03-01T08:55:11.924Z","updated":"2023-03-01T08:55:41.266Z","comments":true,"path":"api/articles/zhihu/未命名.json","keywords":null,"cover":null,"text":"联想拯救者24.5寸显示器 280hz刷新率。 ","link":"","photos":[],"count_time":{"symbolsCount":24,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"feature":true}}